<!--
<!DOCTYPE html> 
  <html manifest="tetris.manifest"> 
  <head> 
  	<meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1.0, maximum-scale=1.0"/> 
  	<meta name="apple-mobile-web-app-capable" content="yes" /> 
  	<meta name="apple-mobile-web-app-status-bar-style" content="black" /> 
  	<link rel="apple-touch-icon" href="iphon_tetris_icon.png"/> 
  	<link rel="apple-touch-startup-image" href="startup.png" /> 
  	<link rel="stylesheet" href="tetris.css" type="text/css" media="screen, mobile" title="main" charset="utf-8"> 
  	  <title>offline Tetris</title> 
  </head> 
  <body> 
  	<script type="text/javascript" src="tetris.js">
  	
  	</script>
  	</body> 
  	</html> 
 -->

<!DOCTYPE html>

<html manifest="nyet.manifest">

  <head>
  	<meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1.0, maximum-scale=1.0"/> 
  	<meta name="apple-mobile-web-app-capable" content="yes" /> 
  	<meta name="apple-mobile-web-app-status-bar-style" content="black" /> 

    <title>NYET</title>

    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        text-align: center;
        word-wrap: normal;
        word-break: normal;
        font-size: 2.3vw;
        -ms-user-select: none;
        -webkit-user-select: none;
        user-select: none;
        font-family: Arial, sans-serif;
      }

      .button {
      	background-color: rgb(48, 136, 165);
      	border: 3px solid black;
        border-radius: 4vh;
        font-size: 4vh;
        line-height: 5vh;
        padding: 1vh;
        color: white;
      }

      .left {
      	float: left;
        display: inline-block;
        visibility: hidden;
      }

      .right {
      	float: right;
        display: inline-block;
      }

      .title {
        display: inline-block;
        font-size: 6vh;
        line-height: 7vh;
      }

      .page-area {
        height: 100vh;
        width: 100vw;
        padding: 1vh 1vw;
        background: lightblue;
      }

      .header-area {
        height: 9vh;
      }

      .main-area {
        height: 89vh;
        padding: 0;
      }

      .rows-container {
        display: grid;
        grid-template-columns: auto;
        grid-gap: 1vh;
        grid-template-rows: 17vh 17vh 17vh 17vh 17vh;
      }

      .line-element {
        border: 1px solid black;
        border-radius: 1vh;
        display: grid;
        grid-template-columns: 0.1fr 0.18fr 0.18fr 0.18fr 0.18fr 0.18fr;
        padding: 2vh 2vw;
        grid-column-gap: 2vh;
      }

      .line-player1 {
        background: rgb(124, 193, 216);
      }

      .line-trump {
        background: rgb(100, 182, 208);
      }

      .line-supertrump {
        background: rgb(74, 170, 202);
      }

      .line-discard {
        background: rgb(55, 156, 189);
      }

      .line-points {
        background: rgb(48, 136, 165);
      }

      .row-title {
      	/*transform: rotate(-90deg);*/
      	overflow: hidden;
      }

      .row-element {
        border: 1px solid black;
        border-radius: 1vh;
        background: white;
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center;
        line-height: 13vh;
      }

      .points {
        font-size: 7vh;
      }

      .points-neg {
        font-size: 7vh;
        color: red;
      }

      .image-heart {
        background-image: url("img/heart.svg");
      }

      .image-spade {
        background-image: url("img/spade.svg");
      }

      .image-diamond {
        background-image: url("img/diamond.svg");
      }

      .image-club {
        background-image: url("img/club.svg");
      }

      .image-st-heart {
        background-image: url("img/crown-heart.svg");
      }

      .image-st-spade {
        background-image: url("img/crown-spade.svg");
      }

      .image-st-diamond {
        background-image: url("img/crown-diamond.svg");
      }

      .image-st-club {
        background-image: url("img/crown-club.svg");
      }

      .image-st-none {
        background-image: url("img/na.svg");
      }

      .image-dis-one {
        background-image: url("img/back-one.svg");
      }

      .image-dis-two {
        background-image: url("img/back-two.svg");
      }

      .image-dis-left {
        background-image: url("img/back-left.svg");
      }

      .image-dis-no-loot {
        background-image: url("img/back-crown.svg");
      }

    </style>

    <script>
      var prevElement = null;
      var currPlayer = 1;
      var playerCnt = 3;

      function getNyetForPlayer()
      {
        switch (currPlayer) {
          case 1: return 'url("img/nyet-blue.svg")';
          case 2: return 'url("img/nyet-red.svg")';
          case 3: return 'url("img/nyet-green.svg")';
          case 4: return 'url("img/nyet-pink.svg")';
          case 5: return 'url("img/nyet-yellow.svg")';
        }
      }

      function removeNyet(elem) {
        style = elem.currentStyle || window.getComputedStyle(elem, false);
        if(style.backgroundImage.includes('nyet-')) {
          elem.style.setProperty('background-color', 'white');
          if(style.backgroundImage.includes(',')) {
            elem.style.setProperty('background-image', style.backgroundImage.replace(/^[^,]*, /g, ''));
          } else {
            elem.style.setProperty('background-image', '');
          }
        }
      }

      function hasNyet(elem) {
        style = elem.currentStyle || window.getComputedStyle(elem, false);
        return style.backgroundImage.includes('nyet-');
      }

      function addNyet(elem) {
        if(!hasNyet(elem)) {
          style = elem.currentStyle || window.getComputedStyle(elem, false);
          elem.style.setProperty('background-color', 'gray');
          if(style.backgroundImage.includes('none')) {
            elem.style.setProperty('background-image', getNyetForPlayer());
          } else {
            elem.style.setProperty('background-image', getNyetForPlayer() + ', ' + style.backgroundImage);
          }
        }
      }

      function decCurrPlayer() {
        currPlayer--;
        if(currPlayer < 1)
        {
          currPlayer = playerCnt;
        }
      }

      function incCurrPlayer() {
        currPlayer++;
        if(currPlayer > playerCnt)
        {
          currPlayer = 1;
        }
      }

      function addListenersOnRow(elem) {
        const elems = elem.parentElement.children;
        for(let i = 1; i < elems.length; i++) {
          if(!hasNyet(elems[i]) && (elems[i].getAttribute('listener') !== 'true')) {
            elems[i].addEventListener('click', elementClicked);
            elems[i].setAttribute('listener', 'true');
          }
        }
      }

      function removeListenersOnRow(elem) {
        const elems = elem.parentElement.children;
        for(let i = 1; i < elems.length; i++) {
          if(elems[i] !== prevElement) {
            removeListenerOnElement(elems[i]);
          }
        }
      }

      function removeListenerOnElement(elem) {
        elem.removeEventListener('click', elementClicked);
        elem.setAttribute('listener', 'false');
      }

      function rowComplete(elem) {
        cnt = 0;
        visCnt = 0;
        const elems = elem.parentElement.children;
        for(let i = 1; i < elems.length; i++) {
          if(hasNyet(elems[i])) {
            cnt++;
          }
          if(window.getComputedStyle(elems[i]).visibility !== 'hidden') {
            visCnt++;
          }
        }
        return (cnt == (visCnt - 1));
      }

      function elementClicked(evt) {
        elem = evt.target;
        if((elem == prevElement) && hasNyet(elem)) {
          removeNyet(elem);
          decCurrPlayer();
          addListenersOnRow(elem);
          prevElement = null;
        } else {
          addNyet(elem);
          incCurrPlayer();
          if(prevElement && (elem != prevElement)) {
            removeListenerOnElement(prevElement);
          }
          prevElement = elem;
          if(rowComplete(elem)) {
            removeListenersOnRow(elem);
          }
        }
      }

      function setName(params, idx, id) {
      	name = params.get(idx);
      	if(name && name !== 'null') {
          elem = document.getElementById(id);
          elem.innerHTML = name;
      	}
      }

      function resetBoard() {
      	const urlParams = new URLSearchParams(window.location.search);
      	pCntTxt = urlParams.get('p');
      	if(pCntTxt && pCntTxt !== 'null') {
      	  playerCnt = parseInt(pCntTxt);
        }
        prevElement = null;

        setName(urlParams, 'a', 'p1');
        setName(urlParams, 'b', 'p2');
        setName(urlParams, 'c', 'p3');
        setName(urlParams, 'd', 'p4');
        setName(urlParams, 'e', 'p5');

        const elems = document.querySelectorAll('.row-element');
        elems.forEach(elem => {
          removeNyet(elem);
          elem.addEventListener('click', elementClicked);
          elem.setAttribute('listener', 'true');
        });
        const ply = document.querySelectorAll('.points');
        for(let i = 0; i < 5; i++){
        	if(i >= playerCnt) {
        		ply[i].style.setProperty('visibility', 'hidden');
        	} else {
        		ply[i].style.setProperty('visibility', 'visible');
        	}
        }
      }

      window.addEventListener('load', function() {
      	screen.orientation.lock('landscape')
      	.then(tmp => {})
      	.catch(err =>{});
        resetBoard();
        document.getElementById('button-reset').addEventListener('click', resetBoard);
      });
    </script>

  </head>

  <body>
    <div class="page-area">
      <div class="header-area">
      	<div class="button left" id="button-new">new</div>
      	<div class="title">NYET</div>
      	<div class="button right" id="button-reset">reset</div>
      </div>
      <div class="main-area">
        <div class="rows-container">
          <div class="line-element line-player1">
            <div class="row-title">First Player</div>
            <div class="row-element points" id="p1">1</div>
            <div class="row-element points" id="p2">2</div>
            <div class="row-element points" id="p3">3</div>
            <div class="row-element points" id="p4">4</div>
            <div class="row-element points" id="p5">5</div>
          </div>
          <div class="line-element line-trump">
            <div class="row-title">Trump</div>
            <div class="row-element image-heart"></div>
            <div class="row-element image-spade"></div>
            <div class="row-element image-diamond"></div>
            <div class="row-element image-club"></div>
          </div>
          <div class="line-element line-supertrump">
            <div class="row-title">Super Trump</div>
            <div class="row-element image-st-heart"></div>
            <div class="row-element image-st-spade"></div>
            <div class="row-element image-st-diamond"></div>
            <div class="row-element image-st-club"></div>
            <div class="row-element image-st-none"></div>
          </div>
          <div class="line-element line-discard">
            <div class="row-title">Discard or Pass</div>
            <div class="row-element image-dis-one"></div>
            <div class="row-element image-dis-two"></div>
            <div class="row-element image-dis-no-loot"></div>
            <div class="row-element image-dis-left"></div>
            <div class="row-element image-st-none"></div>
          </div>
          <div class="line-element line-points">
            <div class="row-title">Points</div>
            <div class="row-element points-neg">-2</div>
            <div class="row-element points">1</div>
            <div class="row-element points">2</div>
            <div class="row-element points">3</div>
            <div class="row-element points">4</div>
        </div>
        </div>
      </div>
    </div>
  </body>

</html>
